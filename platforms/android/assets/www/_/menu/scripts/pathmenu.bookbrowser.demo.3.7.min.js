/*

 Copyright @ 2012 Alessandro Zifiglio
 http://www.typps.com
*/
var g=null;
(function(e,l,c,z){function A(b,a,d,s,n,h,x,f){n=o.join(",").indexOf(a)!==-1;if(!(f.items||a==="menu")){if(n)i=o.indexOf(a);s=u[i];b=o[i];if(n||h==="next"){p=f;j=(d+1)*6;if(!(j>s&&j-6<=0)){a=c.formatString("records between {0} - {1} offset result of {2} from OpenLibrary.org",j-6,j,b);d=c.formatString("http://openlibrary.org{0}.json?limit={1}&offset={2}&has_fulltext=false&sort=editions&callback={3}",b,6,j,"httpResponseSubject");v(d,a)}}else if(a.indexOf("/works/")===0){d=c.formatString("http://openlibrary.org{0}",a);
e.open(d,"_blank");e.focus()}}}function B(b){if(!p.items){var a;b=b.works;var d,s,n=[],h,x=u[i],f,y=true,q=g,C=p.command;m&&e.clearTimeout(m);m=g;for(d in b){a=b[d];h=a.authors;for(s in h)n.push(h[s].name);h=a.key;f=a.cover_id;y=f!==g;a=a.title;if(f===g){f=g;q=a;if(q.length>9)q=(q.substr(0,9)+"...").split(" ").join("<br />")}else{f=c.formatString("http://covers.openlibrary.org/b/id/{0}-{1}.jpg",f,"S");q=g}k.add_item({command:h,text:q,title:c.formatString("{0} written by {1}.",a,n.join(",")),backgroundUrl:f,
insertMask:y},p)}j+6<x&&k.add_item({command:"next"+h,data:"next",title:"Get the next 6 books from Openlibrary",text:"Next 6 >>"},p);w(false);k.render(C);p=g;j=0}}function D(b){var a,d=b.key;a=b.name;b=b.work_count;m&&e.clearTimeout(m);m=g;k.add_item({command:d,text:c.formatString("{0} <br />{1}",a,b),title:c.formatString("{0} {1} books found.",b,a)});u[i]=b;if(i<o.length-1){d=o[++i];a=c.formatString("http://openlibrary.org{0}.json?limit={1}&offset={2}&has_fulltext=false&sort=editions&callback={3}",
d,0,0,"httpResponseSubjects");v(a,d)}else{w(false);k.render()}}function v(b,a){k.set_lock(true);var d=l.getElementsByTagName("head")[0];r&&d.removeChild(r);r=l.createElement("script");w(true,a);r.setAttribute("type","text/javascript");r.setAttribute("src",b);d.appendChild(r);m=e.setTimeout(function(){t.innerHTML=c.formatString("Failed to load {0}. The server is taking too long to respond. Try again.",a);k.set_lock(false)},1E4)}function w(b,a){if(a){t.innerHTML=c.formatString("Loading {0}...",a);e.focus()}b?
c.addCssClass(t,"showstatus"):c.removeCssClass(t,"showstatus")}var k,o=["/subjects/adventure","/subjects/horror","/subjects/humor","/subjects/romance","/subjects/sci-fi","/subjects/suspense"],u=[0,0,0,0,0,0],j=0,i=0,t=l.getElementById("status"),p,m=g,r;c.addEvent(e,"load",function(){e.$m_DEBUG=true;if(l.createElement("canvas").getContext){k=new z({elem:l.getElementById("menu1"),onSelectedItem:A,radius:50,expandPattern:0});var b=o[i],a=c.formatString("http://openlibrary.org{0}.json?limit={1}&offset={2}&has_fulltext=false&sort=editions&callback={3}",
b,0,0,"httpResponseSubjects");e.httpResponseSubjects=D;e.httpResponseSubject=B;v(a,b)}else{c.removeCssClass(l.getElementById("nosupport"),"hide");c.addCssClass(l.getElementById("intro"),"hide")}})})(window,document,window.$m,window.PathMenu);
